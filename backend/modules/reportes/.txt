{
    "id": 2,
    "dni": "50222333",
    "nombre": "Sofía",
    "apellido": "Fernández",
    "email": "sofia.fernandez@example.com",
    "curso": {
        "id": 1,
        "nombre": "Primero A",
        "division": "A",
        "turno": "mañana",
        "anio_lectivo": 2025
    },
    "materias": {
        "Matemática I": {
            "estado_final": "cursando",
            "calificacion_final": null,
            "calificaciones": [
                {
                    "cuatrimestre": "1",
                    "notas": [
                        "4.00",
                        null,
                        null
                    ],
                    "promedio": "4.00"
                },
                {
                    "cuatrimestre": "2",
                    "notas": [
                        "5.00",
                        null,
                        null
                    ],
                    "promedio": "5.00"
                }
            ],
            "asistencias": [
                {
                    "fecha": "2025-10-21T03:00:00.000Z",
                    "estado": "ausente"
                },
                {
                    "fecha": "2025-10-21T03:00:00.000Z",
                    "estado": "ausente"
                }
            ]
        }
    },
    "tutores": [
        {
            "id": 3,
            "nombre": "Carlos",
            "apellido": "Fernández",
            "parentesco": "padre",
            "telefono": null,
            "email": "cfernandez.tutor@example.com"
        }
    ]
}


[
    {
        "id_alumno": 2,
        "dni_alumno": "50222333",
        "nombre_alumno": "Sofía",
        "apellido_alumno": "Fernández",
        "email": "sofia.fernandez@example.com",
        "id_curso": 1,
        "nombre_curso": "Primero A",
        "division": "A",
        "turno": "mañana",
        "anio_lectivo": 2025,
        "id_materia": 1,
        "nombre_materia": "Matemática I",
        "estado_final_materia": "cursando",
        "calificacion_final_materia": null,
        "cuatrimestre": "1",
        "nota_1": "4.00",
        "nota_2": null,
        "nota_3": null,
        "promedio_cuatrimestre": "4.00",
        "periodo_complementario": null,
        "calificacion_definitiva": null,
        "fecha_clase": "2025-10-21T03:00:00.000Z",
        "estado_asistencia": "ausente",
        "id_tutor": 3,
        "nombre_tutor": "Carlos",
        "apellido_tutor": "Fernández",
        "parentesco": "padre",
        "telefono_tutor": null,
        "email_tutor": "cfernandez.tutor@example.com"
    },
    {
        "id_alumno": 2,
        "dni_alumno": "50222333",
        "nombre_alumno": "Sofía",
        "apellido_alumno": "Fernández",
        "email": "sofia.fernandez@example.com",
        "id_curso": 1,
        "nombre_curso": "Primero A",
        "division": "A",
        "turno": "mañana",
        "anio_lectivo": 2025,
        "id_materia": 1,
        "nombre_materia": "Matemática I",
        "estado_final_materia": "cursando",
        "calificacion_final_materia": null,
        "cuatrimestre": "2",
        "nota_1": "5.00",
        "nota_2": null,
        "nota_3": null,
        "promedio_cuatrimestre": "5.00",
        "periodo_complementario": null,
        "calificacion_definitiva": null,
        "fecha_clase": "2025-10-21T03:00:00.000Z",
        "estado_asistencia": "ausente",
        "id_tutor": 3,
        "nombre_tutor": "Carlos",
        "apellido_tutor": "Fernández",
        "parentesco": "padre",
        "telefono_tutor": null,
        "email_tutor": "cfernandez.tutor@example.com"
    }
]


{
    "id": 2,
    "dni": "50222333",
    "nombre": "Sofía",
    "apellido": "Fernández",
    "email": "sofia.fernandez@example.com",
    "curso": {
        "id": 1,
        "nombre": "Primero A",
        "division": "A",
        "turno": "mañana",
        "anio_lectivo": 2025
    },
    "materias": {
        "Matemática I": {
            "estado_final": "cursando",
            "calificacion_final": null,
            "calificaciones": [
                {
                    "cuatrimestre": "1",
                    "notas": [
                        "4.00",
                        null,
                        null
                    ],
                    "promedio": "4.00"
                },
                {
                    "cuatrimestre": "2",
                    "notas": [
                        "5.00",
                        null,
                        null
                    ],
                    "promedio": "5.00"
                }
            ],
            "asistencias": [
                {
                    "fecha": "2025-10-21T03:00:00.000Z",
                    "estado": "ausente"
                },
                {
                    "fecha": "2025-10-21T03:00:00.000Z",
                    "estado": "ausente"
                }
            ]
        }
    },
    "tutores": [
        {
            "id": 3,
            "nombre": "Carlos",
            "apellido": "Fernández",
            "parentesco": "padre",
            "telefono": null,
            "email": "cfernandez.tutor@example.com"
        }
    ]
}



version 01  forma ordenada por cuatrimestre 


exports.getReporteAlumnoPorDNIyAnio = async (req, res) => {
  const { dni, anio } = req.params;

  try {
    const [rows] = await pool.execute(QUERY_REPORTE_ALUMNO, [dni, anio]);

    if (rows.length === 0)
      return res.status(404).json({ message: "Alumno no encontrado o sin datos para ese año lectivo." });

    const alumno = {
      id: rows[0].id_alumno,
      dni: rows[0].dni_alumno,
      nombre: rows[0].nombre_alumno,
      apellido: rows[0].apellido_alumno,
      email: rows[0].email,
      curso: {
        id: rows[0].id_curso,
        nombre: rows[0].nombre_curso,
        division: rows[0].division,
        turno: rows[0].turno,
        anio_lectivo: rows[0].anio_lectivo,
      },
      materias: {},
      tutores: [],
    };

    const tutoresSet = new Set();

    rows.forEach(r => {
      if (r.nombre_materia) {
        if (!alumno.materias[r.nombre_materia]) {
          alumno.materias[r.nombre_materia] = {
            estado_final: r.estado_final_materia,
            calificacion_final: r.calificacion_final_materia,
            calificaciones: [],
            asistencias: []
          };
        }

        if (r.cuatrimestre)
          alumno.materias[r.nombre_materia].calificaciones.push({
            cuatrimestre: r.cuatrimestre,
            notas: [r.nota_1, r.nota_2, r.nota_3],
            promedio: r.promedio_cuatrimestre
          });

        if (r.fecha_clase)
          alumno.materias[r.nombre_materia].asistencias.push({
            fecha: r.fecha_clase,
            estado: r.estado_asistencia
          });
      }

      if (r.id_tutor && !tutoresSet.has(r.id_tutor)) {
        alumno.tutores.push({
          id: r.id_tutor,
          nombre: r.nombre_tutor,
          apellido: r.apellido_tutor,
          parentesco: r.parentesco,
          telefono: r.telefono_tutor,
          email: r.email_tutor
        });
        tutoresSet.add(r.id_tutor);
      }
    });

    res.status(200).json(alumno);
  } catch (error) {
    console.error("Error en reporte alumno:", error);
    res.status(500).json({ message: "Error interno del servidor al generar el reporte." });
  }
};



version dos, todos los datos separados 

exports.getReporteAlumnoPorDNIyAnio = async (req, res) => {
  const { dni, anio } = req.params;
  console.log("🟢 Entró al controlador de reporte de alumno");
  console.log("🔍 Parámetros recibidos:", dni, anio);

  try {
    console.log("🟡 Ejecutando consulta SQL...");
    const result = await pool.execute(QUERY_REPORTE_ALUMNO, [dni, anio]);
    console.log("✅ Resultado SQL:", result);

    const [rows] = result;
    console.log("📊 Filas:", rows);

    if (!rows.length) {
      return res.status(404).json({ message: "No se encontraron datos." });
    }

    res.status(200).json(rows);
  } catch (error) {
    console.error("❌ Error en reporte alumno:", error);
    res.status(500).json({ message: "Error interno del servidor al generar el reporte." });
  }
};